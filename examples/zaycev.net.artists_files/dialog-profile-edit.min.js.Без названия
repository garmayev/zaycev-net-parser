(function(){function h(a){var b=$("#"+a);b.length||(b=$(ZINA.el("div",{id:a})));return b}function k(a){a.off(".zinaProfileEdit");a.html(ZINA.el("div.zina-dialog-progress"));a.dialog({modal:!0});a.find(".zina-dialog-progress").css("marginTop",a.height()/2);a.removeClass("zina-profile-edit-email-state-success")}function l(a,b){b.command?(a.empty(),$.each(b.command,function(b,c){a.append(ZINA.el("div",[c]))})):a.find(":input").each(function(){var a=$(this).parent(),c=$(this).attr("name");a.find(".zina-profile-error").remove();
b[c]&&$.each(b[c],function(b,c){a.append(ZINA.el("div.zina-profile-error",[c]))})})}ZINA.namespace("ZINA.Profile.Edit",{email:function(a,b){b=b||"";a=a||h("zina-profile-edit-email");k(a);var e=$.Deferred(),c=e.promise();$.ajax({url:"/profile/ajaxRequestEmail.php",data:{context:b}}).done(function(b){b&&b.messages?(a.empty(),a.append(ZINA.el("div.zina-profile-edit-email-form.dialog-form",[ZINA.el("div.zina-profile-edit-email-description",[b.messages.contextDescription]),ZINA.el("label.zina-profile-edit-email-label.zina-profile-edit-row",
{"for":"zina-profile-edit-email-value"},[b.messages.emailLabel]),ZINA.el("div.zina-profile-edit-row.row",[ZINA.el("input#zina-profile-edit-email-value.zina-profile-edit-email-value.text",{type:"text",name:"email",value:b.email,"data-email":b.email})]),ZINA.el("div.zina-profile-edit-row",[ZINA.el("button.zina-profile-edit-email-update",[ZINA.el("span.btn-span",[b.messages.emailUpdateButton])])])])),a.append(ZINA.el("div.zina-profile-edit-email-success",[b.messages.emailUpdateSuccess])),a.dialog("option",
"title",b.messages.title)):(a.html("\u041d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u043e\u0432\u0430\u0442\u044c\u0441\u044f"),a.on("dialogclose",function(){location.reload()}))});a.on("click.zinaProfileEdit",".zina-profile-edit-email-update",function(){function b(){a.addClass("zina-profile-edit-email-state-success");e.resolveWith(c)}var d=a.find(".zina-profile-edit-email-value"),f=a.find(".zina-profile-edit-email-update"),g=$.trim(d.val());
f.attr("disabled")||(g==d.data("email")&&g?b():(d.add(f).attr("disabled",!0),$.ajax({url:"/profile/ajaxUpdateEmail.php",type:"post",data:{email:g}}).done(function(c){c.errors?l(a,c.errors):b()}).always(function(){d.add(f).attr("disabled",!1)})))});a.on("dialogclose",function(){e.rejectWith(c)});return c}})})();