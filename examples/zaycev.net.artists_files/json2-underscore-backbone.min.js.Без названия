var JSON;JSON||(JSON={});
(function(){function n(e){return 10>e?"0"+e:e}function y(e){f.lastIndex=0;return f.test(e)?'"'+e.replace(f,function(e){var f=E[e];return"string"===typeof f?f:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function B(f,n){var r,p,v,w,z=e,t,l=n[f];l&&"object"===typeof l&&"function"===typeof l.toJSON&&(l=l.toJSON(f));"function"===typeof q&&(l=q.call(n,f,l));switch(typeof l){case "string":return y(l);case "number":return isFinite(l)?String(l):"null";case "boolean":case "null":return String(l);case "object":if(!l)return"null";
e+=h;t=[];if("[object Array]"===Object.prototype.toString.apply(l)){w=l.length;for(r=0;r<w;r+=1)t[r]=B(r,l)||"null";v=0===t.length?"[]":e?"[\n"+e+t.join(",\n"+e)+"\n"+z+"]":"["+t.join(",")+"]";e=z;return v}if(q&&"object"===typeof q)for(w=q.length,r=0;r<w;r+=1)p=q[r],"string"===typeof p&&(v=B(p,l))&&t.push(y(p)+(e?": ":":")+v);else for(p in l)Object.hasOwnProperty.call(l,p)&&(v=B(p,l))&&t.push(y(p)+(e?": ":":")+v);v=0===t.length?"{}":e?"{\n"+e+t.join(",\n"+e)+"\n"+z+"}":"{"+t.join(",")+"}";e=z;return v}}
"function"!==typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(e){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+n(this.getUTCMonth()+1)+"-"+n(this.getUTCDate())+"T"+n(this.getUTCHours())+":"+n(this.getUTCMinutes())+":"+n(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(e){return this.valueOf()});var x=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,f=
/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,e,h,E={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},q;"function"!==typeof JSON.stringify&&(JSON.stringify=function(f,n,r){var p;h=e="";if("number"===typeof r)for(p=0;p<r;p+=1)h+=" ";else"string"===typeof r&&(h=r);if((q=n)&&"function"!==typeof n&&("object"!==typeof n||"number"!==typeof n.length))throw Error("JSON.stringify");return B("",{"":f})});
"function"!==typeof JSON.parse&&(JSON.parse=function(e,f){function h(e,n){var p,q,l=e[n];if(l&&"object"===typeof l)for(p in l)Object.hasOwnProperty.call(l,p)&&(q=h(l,p),void 0!==q?l[p]=q:delete l[p]);return f.call(e,n,l)}var n;e=String(e);x.lastIndex=0;x.test(e)&&(e=e.replace(x,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(e.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return n=eval("("+e+")"),"function"===typeof f?h({"":n},""):n;throw new SyntaxError("JSON.parse");})})();
(function(){function n(g,a,m){if(g===a)return 0!==g||1/g==1/a;if(null==g||null==a)return g===a;g._chain&&(g=g._wrapped);a._chain&&(a=a._wrapped);if(g.isEqual&&b.isFunction(g.isEqual))return g.isEqual(a);if(a.isEqual&&b.isFunction(a.isEqual))return a.isEqual(g);var c=q.call(g);if(c!=q.call(a))return!1;switch(c){case "[object String]":return g==String(a);case "[object Number]":return g!=+g?a!=+a:0==g?1/g==1/a:g==+a;case "[object Date]":case "[object Boolean]":return+g==+a;case "[object RegExp]":return g.source==
a.source&&g.global==a.global&&g.multiline==a.multiline&&g.ignoreCase==a.ignoreCase}if("object"!=typeof g||"object"!=typeof a)return!1;for(var d=m.length;d--;)if(m[d]==g)return!0;m.push(g);var d=0,e=!0;if("[object Array]"==c){if(d=g.length,e=d==a.length)for(;d--&&(e=d in g==d in a&&n(g[d],a[d],m)););}else{if("constructor"in g!="constructor"in a||g.constructor!=a.constructor)return!1;for(var k in g)if(b.has(g,k)&&(d++,!(e=b.has(a,k)&&n(g[k],a[k],m))))break;if(e){for(k in a)if(b.has(a,k)&&!d--)break;
e=!d}}m.pop();return e}var y=this,B=y._,x={},f=Array.prototype,e=Object.prototype,h=f.slice,E=f.unshift,q=e.toString,I=e.hasOwnProperty,D=f.forEach,r=f.map,p=f.reduce,v=f.reduceRight,w=f.filter,z=f.every,t=f.some,l=f.indexOf,A=f.lastIndexOf,e=Array.isArray,H=Object.keys,a=Function.prototype.bind,b=function(b){return new C(b)};"undefined"!==typeof exports?("undefined"!==typeof module&&module.exports&&(exports=module.exports=b),exports._=b):y._=b;b.VERSION="1.3.3";var c=b.each=b.forEach=function(a,
u,m){if(null!=a)if(D&&a.forEach===D)a.forEach(u,m);else if(a.length===+a.length)for(var c=0,d=a.length;c<d&&!(c in a&&u.call(m,a[c],c,a)===x);c++);else for(c in a)if(b.has(a,c)&&u.call(m,a[c],c,a)===x)break};b.map=b.collect=function(b,a,m){var d=[];if(null==b)return d;if(r&&b.map===r)return b.map(a,m);c(b,function(b,g,c){d[d.length]=a.call(m,b,g,c)});b.length===+b.length&&(d.length=b.length);return d};b.reduce=b.foldl=b.inject=function(a,u,m,d){var e=2<arguments.length;null==a&&(a=[]);if(p&&a.reduce===
p)return d&&(u=b.bind(u,d)),e?a.reduce(u,m):a.reduce(u);c(a,function(b,a,g){e?m=u.call(d,m,b,a,g):(m=b,e=!0)});if(!e)throw new TypeError("Reduce of empty array with no initial value");return m};b.reduceRight=b.foldr=function(a,c,m,d){var e=2<arguments.length;null==a&&(a=[]);if(v&&a.reduceRight===v)return d&&(c=b.bind(c,d)),e?a.reduceRight(c,m):a.reduceRight(c);var k=b.toArray(a).reverse();d&&!e&&(c=b.bind(c,d));return e?b.reduce(k,c,m,d):b.reduce(k,c)};b.find=b.detect=function(b,a,c){var e;d(b,function(b,
g,d){if(a.call(c,b,g,d))return e=b,!0});return e};b.filter=b.select=function(b,a,m){var d=[];if(null==b)return d;if(w&&b.filter===w)return b.filter(a,m);c(b,function(b,g,c){a.call(m,b,g,c)&&(d[d.length]=b)});return d};b.reject=function(b,a,m){var d=[];if(null==b)return d;c(b,function(b,g,c){a.call(m,b,g,c)||(d[d.length]=b)});return d};b.every=b.all=function(b,a,m){var d=!0;if(null==b)return d;if(z&&b.every===z)return b.every(a,m);c(b,function(b,g,c){if(!(d=d&&a.call(m,b,g,c)))return x});return!!d};
var d=b.some=b.any=function(a,u,m){u||(u=b.identity);var d=!1;if(null==a)return d;if(t&&a.some===t)return a.some(u,m);c(a,function(b,a,g){if(d||(d=u.call(m,b,a,g)))return x});return!!d};b.include=b.contains=function(b,a){var c=!1;return null==b?c:l&&b.indexOf===l?-1!=b.indexOf(a):c=d(b,function(b){return b===a})};b.invoke=function(a,c){var m=h.call(arguments,2);return b.map(a,function(a){return(b.isFunction(c)?c||a:a[c]).apply(a,m)})};b.pluck=function(a,c){return b.map(a,function(b){return b[c]})};
b.max=function(a,d,m){if(!d&&b.isArray(a)&&a[0]===+a[0])return Math.max.apply(Math,a);if(!d&&b.isEmpty(a))return-Infinity;var e={computed:-Infinity};c(a,function(b,a,g){a=d?d.call(m,b,a,g):b;a>=e.computed&&(e={value:b,computed:a})});return e.value};b.min=function(a,d,m){if(!d&&b.isArray(a)&&a[0]===+a[0])return Math.min.apply(Math,a);if(!d&&b.isEmpty(a))return Infinity;var e={computed:Infinity};c(a,function(b,a,g){a=d?d.call(m,b,a,g):b;a<e.computed&&(e={value:b,computed:a})});return e.value};b.shuffle=
function(b){var a=[],d;c(b,function(b,g,c){d=Math.floor(Math.random()*(g+1));a[g]=a[d];a[d]=b});return a};b.sortBy=function(a,c,d){var e=b.isFunction(c)?c:function(b){return b[c]};return b.pluck(b.map(a,function(b,a,g){return{value:b,criteria:e.call(d,b,a,g)}}).sort(function(b,a){var g=b.criteria,c=a.criteria;return void 0===g?1:void 0===c?-1:g<c?-1:g>c?1:0}),"value")};b.groupBy=function(a,d){var m={},e=b.isFunction(d)?d:function(b){return b[d]};c(a,function(b,a){var g=e(b,a);(m[g]||(m[g]=[])).push(b)});
return m};b.sortedIndex=function(a,c,d){d||(d=b.identity);for(var e=0,k=a.length;e<k;){var f=e+k>>1;d(a[f])<d(c)?e=f+1:k=f}return e};b.toArray=function(a){return a?b.isArray(a)||b.isArguments(a)?h.call(a):a.toArray&&b.isFunction(a.toArray)?a.toArray():b.values(a):[]};b.size=function(a){return b.isArray(a)?a.length:b.keys(a).length};b.first=b.head=b.take=function(b,a,c){return null==a||c?b[0]:h.call(b,0,a)};b.initial=function(b,a,c){return h.call(b,0,b.length-(null==a||c?1:a))};b.last=function(b,a,
c){return null==a||c?b[b.length-1]:h.call(b,Math.max(b.length-a,0))};b.rest=b.tail=function(b,a,c){return h.call(b,null==a||c?1:a)};b.compact=function(a){return b.filter(a,function(b){return!!b})};b.flatten=function(a,c){return b.reduce(a,function(a,g){if(b.isArray(g))return a.concat(c?g:b.flatten(g));a[a.length]=g;return a},[])};b.without=function(a){return b.difference(a,h.call(arguments,1))};b.uniq=b.unique=function(a,c,d){d=d?b.map(a,d):a;var e=[];3>a.length&&(c=!0);b.reduce(d,function(d,m,k){(c?
b.last(d)===m&&d.length:b.include(d,m))||(d.push(m),e.push(a[k]));return d},[]);return e};b.union=function(){return b.uniq(b.flatten(arguments,!0))};b.intersection=b.intersect=function(a){var c=h.call(arguments,1);return b.filter(b.uniq(a),function(a){return b.every(c,function(g){return 0<=b.indexOf(g,a)})})};b.difference=function(a){var c=b.flatten(h.call(arguments,1),!0);return b.filter(a,function(a){return!b.include(c,a)})};b.zip=function(){for(var a=h.call(arguments),c=b.max(b.pluck(a,"length")),
d=Array(c),e=0;e<c;e++)d[e]=b.pluck(a,""+e);return d};b.indexOf=function(a,c,d){if(null==a)return-1;var e;if(d)return d=b.sortedIndex(a,c),a[d]===c?d:-1;if(l&&a.indexOf===l)return a.indexOf(c);d=0;for(e=a.length;d<e;d++)if(d in a&&a[d]===c)return d;return-1};b.lastIndexOf=function(a,b){if(null==a)return-1;if(A&&a.lastIndexOf===A)return a.lastIndexOf(b);for(var c=a.length;c--;)if(c in a&&a[c]===b)return c;return-1};b.range=function(a,b,c){1>=arguments.length&&(b=a||0,a=0);c=arguments[2]||1;for(var d=
Math.max(Math.ceil((b-a)/c),0),e=0,k=Array(d);e<d;)k[e++]=a,a+=c;return k};var k=function(){};b.bind=function(c,d){var e,f;if(c.bind===a&&a)return a.apply(c,h.call(arguments,1));if(!b.isFunction(c))throw new TypeError;f=h.call(arguments,2);return e=function(){if(!(this instanceof e))return c.apply(d,f.concat(h.call(arguments)));k.prototype=c.prototype;var a=new k,b=c.apply(a,f.concat(h.call(arguments)));return Object(b)===b?b:a}};b.bindAll=function(a){var d=h.call(arguments,1);0==d.length&&(d=b.functions(a));
c(d,function(c){a[c]=b.bind(a[c],a)});return a};b.memoize=function(a,c){var d={};c||(c=b.identity);return function(){var e=c.apply(this,arguments);return b.has(d,e)?d[e]:d[e]=a.apply(this,arguments)}};b.delay=function(a,b){var c=h.call(arguments,2);return setTimeout(function(){return a.apply(null,c)},b)};b.defer=function(a){return b.delay.apply(b,[a,1].concat(h.call(arguments,1)))};b.throttle=function(a,c){var d,e,k,f,F,h,l=b.debounce(function(){F=f=!1},c);return function(){d=this;e=arguments;k||
(k=setTimeout(function(){k=null;F&&a.apply(d,e);l()},c));f?F=!0:h=a.apply(d,e);l();f=!0;return h}};b.debounce=function(a,b,c){var d;return function(){var e=this,k=arguments;c&&!d&&a.apply(e,k);clearTimeout(d);d=setTimeout(function(){d=null;c||a.apply(e,k)},b)}};b.once=function(a){var b=!1,c;return function(){if(b)return c;b=!0;return c=a.apply(this,arguments)}};b.wrap=function(a,b){return function(){var c=[a].concat(h.call(arguments,0));return b.apply(this,c)}};b.compose=function(){var a=arguments;
return function(){for(var b=arguments,c=a.length-1;0<=c;c--)b=[a[c].apply(this,b)];return b[0]}};b.after=function(a,b){return 0>=a?b():function(){if(1>--a)return b.apply(this,arguments)}};b.keys=H||function(a){if(a!==Object(a))throw new TypeError("Invalid object");var c=[],d;for(d in a)b.has(a,d)&&(c[c.length]=d);return c};b.values=function(a){return b.map(a,b.identity)};b.functions=b.methods=function(a){var c=[],d;for(d in a)b.isFunction(a[d])&&c.push(d);return c.sort()};b.extend=function(a){c(h.call(arguments,
1),function(b){for(var c in b)a[c]=b[c]});return a};b.pick=function(a){var d={};c(b.flatten(h.call(arguments,1)),function(b){b in a&&(d[b]=a[b])});return d};b.defaults=function(a){c(h.call(arguments,1),function(b){for(var c in b)null==a[c]&&(a[c]=b[c])});return a};b.clone=function(a){return b.isObject(a)?b.isArray(a)?a.slice():b.extend({},a):a};b.tap=function(a,b){b(a);return a};b.isEqual=function(a,b){return n(a,b,[])};b.isEmpty=function(a){if(null==a)return!0;if(b.isArray(a)||b.isString(a))return 0===
a.length;for(var c in a)if(b.has(a,c))return!1;return!0};b.isElement=function(a){return!(!a||1!=a.nodeType)};b.isArray=e||function(a){return"[object Array]"==q.call(a)};b.isObject=function(a){return a===Object(a)};b.isArguments=function(a){return"[object Arguments]"==q.call(a)};b.isArguments(arguments)||(b.isArguments=function(a){return!(!a||!b.has(a,"callee"))});b.isFunction=function(a){return"[object Function]"==q.call(a)};b.isString=function(a){return"[object String]"==q.call(a)};b.isNumber=function(a){return"[object Number]"==
q.call(a)};b.isFinite=function(a){return b.isNumber(a)&&isFinite(a)};b.isNaN=function(a){return a!==a};b.isBoolean=function(a){return!0===a||!1===a||"[object Boolean]"==q.call(a)};b.isDate=function(a){return"[object Date]"==q.call(a)};b.isRegExp=function(a){return"[object RegExp]"==q.call(a)};b.isNull=function(a){return null===a};b.isUndefined=function(a){return void 0===a};b.has=function(a,b){return I.call(a,b)};b.noConflict=function(){y._=B;return this};b.identity=function(a){return a};b.times=
function(a,b,c){for(var d=0;d<a;d++)b.call(c,d)};b.escape=function(a){return(""+a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")};b.result=function(a,c){if(null==a)return null;var d=a[c];return b.isFunction(d)?d.call(a):d};b.mixin=function(a){c(b.functions(a),function(c){N(c,b[c]=a[c])})};var F=0;b.uniqueId=function(a){var b=F++;return a?a+b:b};b.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,
escape:/<%-([\s\S]+?)%>/g};var J=/.^/,G={"\\":"\\","'":"'",r:"\r",n:"\n",t:"\t",u2028:"\u2028",u2029:"\u2029"},K;for(K in G)G[G[K]]=K;var O=/\\|'|\r|\n|\t|\u2028|\u2029/g,P=/\\(\\|'|r|n|t|u2028|u2029)/g,L=function(a){return a.replace(P,function(a,b){return G[b]})};b.template=function(a,c,d){d=b.defaults(d||{},b.templateSettings);a="__p+='"+a.replace(O,function(a){return"\\"+G[a]}).replace(d.escape||J,function(a,b){return"'+\n_.escape("+L(b)+")+\n'"}).replace(d.interpolate||J,function(a,b){return"'+\n("+
L(b)+")+\n'"}).replace(d.evaluate||J,function(a,b){return"';\n"+L(b)+"\n;__p+='"})+"';\n";d.variable||(a="with(obj||{}){\n"+a+"}\n");a="var __p='';var print=function(){__p+=Array.prototype.join.call(arguments, '')};\n"+a+"return __p;\n";var e=new Function(d.variable||"obj","_",a);if(c)return e(c,b);c=function(a){return e.call(this,a,b)};c.source="function("+(d.variable||"obj")+"){\n"+a+"}";return c};b.chain=function(a){return b(a).chain()};var C=function(a){this._wrapped=a};b.prototype=C.prototype;
var M=function(a,c){return c?b(a).chain():a},N=function(a,c){C.prototype[a]=function(){var a=h.call(arguments);E.call(a,this._wrapped);return M(c.apply(b,a),this._chain)}};b.mixin(b);c("pop push reverse shift sort splice unshift".split(" "),function(a){var b=f[a];C.prototype[a]=function(){var c=this._wrapped;b.apply(c,arguments);var d=c.length;"shift"!=a&&"splice"!=a||0!==d||delete c[0];return M(c,this._chain)}});c(["concat","join","slice"],function(a){var b=f[a];C.prototype[a]=function(){return M(b.apply(this._wrapped,
arguments),this._chain)}});C.prototype.chain=function(){this._chain=!0;return this};C.prototype.value=function(){return this._wrapped}}).call(this);
(function(){var n=this,y=n.Backbone,B=Array.prototype.slice,x=Array.prototype.splice,f;f="undefined"!==typeof exports?exports:n.Backbone={};f.VERSION="0.9.1";var e=n._;!e&&"undefined"!==typeof require&&(e=require("underscore"));var h=n.jQuery||n.Zepto||n.ender;f.setDomLibrary=function(a){h=a};f.noConflict=function(){n.Backbone=y;return this};f.emulateHTTP=!1;f.emulateJSON=!1;f.Events={on:function(a,b,c){var d;a=a.split(/\s+/);for(var e=this._callbacks||(this._callbacks={});d=a.shift();){d=e[d]||(e[d]=
{});var f=d.tail||(d.tail=d.next={});f.callback=b;f.context=c;d.tail=f.next={}}return this},off:function(a,b,c){var d,e,f;if(a){if(e=this._callbacks)for(a=a.split(/\s+/);d=a.shift();)if(f=e[d],delete e[d],b&&f)for(;(f=f.next)&&f.next;)if(f.callback!==b||c&&f.context!==c)this.on(d,f.callback,f.context)}else delete this._callbacks;return this},trigger:function(a){var b,c,d,e;if(!(d=this._callbacks))return this;e=d.all;for((a=a.split(/\s+/)).push(null);b=a.shift();)e&&a.push({next:e.next,tail:e.tail,
event:b}),(c=d[b])&&a.push({next:c.next,tail:c.tail});for(e=B.call(arguments,1);c=a.pop();)for(b=c.tail,d=c.event?[c.event].concat(e):e;(c=c.next)!==b;)c.callback.apply(c.context||this,d);return this}};f.Events.bind=f.Events.on;f.Events.unbind=f.Events.off;f.Model=function(a,b){var c;a||(a={});b&&b.parse&&(a=this.parse(a));if(c=A(this,"defaults"))a=e.extend({},c,a);b&&b.collection&&(this.collection=b.collection);this.attributes={};this._escapedAttributes={};this.cid=e.uniqueId("c");this.set(a,{silent:!0});
delete this._changed;this._previousAttributes=e.clone(this.attributes);this.initialize.apply(this,arguments)};e.extend(f.Model.prototype,f.Events,{idAttribute:"id",initialize:function(){},toJSON:function(){return e.clone(this.attributes)},get:function(a){return this.attributes[a]},escape:function(a){var b;if(b=this._escapedAttributes[a])return b;b=this.attributes[a];return this._escapedAttributes[a]=e.escape(null==b?"":""+b)},has:function(a){return null!=this.attributes[a]},set:function(a,b,c){var d,
k;e.isObject(a)||null==a?(d=a,c=b):(d={},d[a]=b);c||(c={});if(!d)return this;d instanceof f.Model&&(d=d.attributes);if(c.unset)for(k in d)d[k]=void 0;if(!this._validate(d,c))return!1;this.idAttribute in d&&(this.id=d[this.idAttribute]);b=this.attributes;var h=this._escapedAttributes,l=this._previousAttributes||{},n=this._setting;this._changed||(this._changed={});this._setting=!0;for(k in d)(a=d[k],e.isEqual(b[k],a)||delete h[k],c.unset?delete b[k]:b[k]=a,!c.silent&&this._changing&&!e.isEqual(this._changed[k],
a)&&(this.trigger("change:"+k,this,a,c),this._moreChanges=!0),delete this._changed[k],e.isEqual(l[k],a)&&e.has(b,k)==e.has(l,k))||(this._changed[k]=a);n||(!c.silent&&this.hasChanged()&&this.change(c),this._setting=!1);return this},unset:function(a,b){(b||(b={})).unset=!0;return this.set(a,null,b)},clear:function(a){(a||(a={})).unset=!0;return this.set(e.clone(this.attributes),a)},fetch:function(a){a=a?e.clone(a):{};var b=this,c=a.success;a.success=function(d,e,f){if(!b.set(b.parse(d,f),a))return!1;
c&&c(b,d)};a.error=f.wrapError(a.error,b,a);return(this.sync||f.sync).call(this,"read",this,a)},save:function(a,b,c){var d,k;e.isObject(a)||null==a?(d=a,c=b):(d={},d[a]=b);c=c?e.clone(c):{};c.wait&&(k=e.clone(this.attributes));a=e.extend({},c,{silent:!0});if(d&&!this.set(d,c.wait?a:c))return!1;var h=this,l=c.success;c.success=function(a,b,f){b=h.parse(a,f);c.wait&&(b=e.extend(d||{},b));if(!h.set(b,c))return!1;l?l(h,a):h.trigger("sync",h,a,c)};c.error=f.wrapError(c.error,h,c);b=this.isNew()?"create":
"update";b=(this.sync||f.sync).call(this,b,this,c);c.wait&&this.set(k,a);return b},destroy:function(a){a=a?e.clone(a):{};var b=this,c=a.success,d=function(){b.trigger("destroy",b,b.collection,a)};if(this.isNew())return d();a.success=function(e){a.wait&&d();c?c(b,e):b.trigger("sync",b,e,a)};a.error=f.wrapError(a.error,b,a);var k=(this.sync||f.sync).call(this,"delete",this,a);a.wait||d();return k},url:function(){var a=A(this.collection,"url")||A(this,"urlRoot")||H();return this.isNew()?a:a+("/"==a.charAt(a.length-
1)?"":"/")+encodeURIComponent(this.id)},parse:function(a){return a},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return null==this.id},change:function(a){if(this._changing||!this.hasChanged())return this;this._moreChanges=this._changing=!0;for(var b in this._changed)this.trigger("change:"+b,this,this._changed[b],a);for(;this._moreChanges;)this._moreChanges=!1,this.trigger("change",this,a);this._previousAttributes=e.clone(this.attributes);delete this._changed;this._changing=
!1;return this},hasChanged:function(a){return arguments.length?this._changed&&e.has(this._changed,a):!e.isEmpty(this._changed)},changedAttributes:function(a){if(!a)return this.hasChanged()?e.clone(this._changed):!1;var b,c=!1,d=this._previousAttributes,f;for(f in a)e.isEqual(d[f],b=a[f])||((c||(c={}))[f]=b);return c},previous:function(a){return arguments.length&&this._previousAttributes?this._previousAttributes[a]:null},previousAttributes:function(){return e.clone(this._previousAttributes)},isValid:function(){return!this.validate(this.attributes)},
_validate:function(a,b){if(b.silent||!this.validate)return!0;a=e.extend({},this.attributes,a);var c=this.validate(a,b);if(!c)return!0;b&&b.error?b.error(this,c,b):this.trigger("error",this,c,b);return!1}});f.Collection=function(a,b){b||(b={});b.comparator&&(this.comparator=b.comparator);this._reset();this.initialize.apply(this,arguments);a&&this.reset(a,{silent:!0,parse:b.parse})};e.extend(f.Collection.prototype,f.Events,{model:f.Model,initialize:function(){},toJSON:function(){return this.map(function(a){return a.toJSON()})},
add:function(a,b){var c,d,f,h,l,n={},p={};b||(b={});a=e.isArray(a)?a.slice():[a];c=0;for(d=a.length;c<d;c++){if(!(f=a[c]=this._prepareModel(a[c],b)))throw Error("Can't add an invalid model to a collection");if(n[h=f.cid]||this._byCid[h]||null!=(l=f.id)&&(p[l]||this._byId[l]))throw Error("Can't add the same model to a collection twice");n[h]=p[l]=f}for(c=0;c<d;c++)(f=a[c]).on("all",this._onModelEvent,this),this._byCid[f.cid]=f,null!=f.id&&(this._byId[f.id]=f);this.length+=d;x.apply(this.models,[null!=
b.at?b.at:this.models.length,0].concat(a));this.comparator&&this.sort({silent:!0});if(b.silent)return this;c=0;for(d=this.models.length;c<d;c++)n[(f=this.models[c]).cid]&&(b.index=c,f.trigger("add",f,this,b));return this},remove:function(a,b){var c,d,f,h;b||(b={});a=e.isArray(a)?a.slice():[a];c=0;for(d=a.length;c<d;c++)if(h=this.getByCid(a[c])||this.get(a[c]))delete this._byId[h.id],delete this._byCid[h.cid],f=this.indexOf(h),this.models.splice(f,1),this.length--,b.silent||(b.index=f,h.trigger("remove",
h,this,b)),this._removeReference(h);return this},get:function(a){return null==a?null:this._byId[null!=a.id?a.id:a]},getByCid:function(a){return a&&this._byCid[a.cid||a]},at:function(a){return this.models[a]},sort:function(a){a||(a={});if(!this.comparator)throw Error("Cannot sort a set without a comparator");var b=e.bind(this.comparator,this);1==this.comparator.length?this.models=this.sortBy(b):this.models.sort(b);a.silent||this.trigger("reset",this,a);return this},pluck:function(a){return e.map(this.models,
function(b){return b.get(a)})},reset:function(a,b){a||(a=[]);b||(b={});for(var c=0,d=this.models.length;c<d;c++)this._removeReference(this.models[c]);this._reset();this.add(a,{silent:!0,parse:b.parse});b.silent||this.trigger("reset",this,b);return this},fetch:function(a){a=a?e.clone(a):{};void 0===a.parse&&(a.parse=!0);var b=this,c=a.success;a.success=function(d,e,f){b[a.add?"add":"reset"](b.parse(d,f),a);c&&c(b,d)};a.error=f.wrapError(a.error,b,a);return(this.sync||f.sync).call(this,"read",this,
a)},create:function(a,b){var c=this;b=b?e.clone(b):{};a=this._prepareModel(a,b);if(!a)return!1;b.wait||c.add(a,b);var d=b.success;b.success=function(e,f){b.wait&&c.add(e,b);d?d(e,f):e.trigger("sync",a,f,b)};a.save(null,b);return a},parse:function(a){return a},chain:function(){return e(this.models).chain()},_reset:function(){this.length=0;this.models=[];this._byId={};this._byCid={}},_prepareModel:function(a,b){a instanceof f.Model?a.collection||(a.collection=this):(b.collection=this,a=new this.model(a,
b),a._validate(a.attributes,b)||(a=!1));return a},_removeReference:function(a){this==a.collection&&delete a.collection;a.off("all",this._onModelEvent,this)},_onModelEvent:function(a,b,c,d){("add"==a||"remove"==a)&&c!=this||("destroy"==a&&this.remove(b,d),b&&a==="change:"+b.idAttribute&&(delete this._byId[b.previous(b.idAttribute)],this._byId[b.id]=b),this.trigger.apply(this,arguments))}});e.each("forEach each map reduce reduceRight find detect filter select reject every all some any include contains invoke max min sortBy sortedIndex toArray size first initial rest last without indexOf shuffle lastIndexOf isEmpty groupBy".split(" "),
function(a){f.Collection.prototype[a]=function(){return e[a].apply(e,[this.models].concat(e.toArray(arguments)))}});f.Router=function(a){a||(a={});a.routes&&(this.routes=a.routes);this._bindRoutes();this.initialize.apply(this,arguments)};var E=/:\w+/g,q=/\*\w+/g,I=/[-[\]{}()+?.,\\^$|#\s]/g;e.extend(f.Router.prototype,f.Events,{initialize:function(){},route:function(a,b,c){f.history||(f.history=new f.History);e.isRegExp(a)||(a=this._routeToRegExp(a));c||(c=this[b]);f.history.route(a,e.bind(function(d){d=
this._extractParameters(a,d);c&&c.apply(this,d);this.trigger.apply(this,["route:"+b].concat(d));f.history.trigger("route",this,b,d)},this));return this},navigate:function(a,b){f.history.navigate(a,b)},_bindRoutes:function(){if(this.routes){var a=[],b;for(b in this.routes)a.unshift([b,this.routes[b]]);b=0;for(var c=a.length;b<c;b++)this.route(a[b][0],a[b][1],this[a[b][1]])}},_routeToRegExp:function(a){a=a.replace(I,"\\$&").replace(E,"([^/]+)").replace(q,"(.*?)");return RegExp("^"+a+"$")},_extractParameters:function(a,
b){return a.exec(b).slice(1)}});f.History=function(){this.handlers=[];e.bindAll(this,"checkUrl")};var D=/^[#/]/,r=/msie [\w.]+/,p=!1;e.extend(f.History.prototype,f.Events,{interval:50,getFragment:function(a,b){if(null==a)if(this._hasPushState||b){a=window.location.pathname;var c=window.location.search;c&&(a+=c)}else a=window.location.hash;a=decodeURIComponent(a);a.indexOf(this.options.root)||(a=a.substr(this.options.root.length));return a.replace(D,"")},start:function(a){if(p)throw Error("Backbone.history has already been started");
this.options=e.extend({},{root:"/"},this.options,a);this._wantsHashChange=!1!==this.options.hashChange;this._wantsPushState=!!this.options.pushState;this._hasPushState=!(!this.options.pushState||!window.history||!window.history.pushState);a=this.getFragment();var b=document.documentMode;if(b=r.exec(navigator.userAgent.toLowerCase())&&(!b||7>=b))this.iframe=h('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(a);this._hasPushState?h(window).bind("popstate",
this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!b?h(window).bind("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval));this.fragment=a;p=!0;a=window.location;b=a.pathname==this.options.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!b)return this.fragment=this.getFragment(null,!0),window.location.replace(this.options.root+"#"+this.fragment),!0;this._wantsPushState&&this._hasPushState&&b&&a.hash&&
(this.fragment=a.hash.replace(D,""),window.history.replaceState({},document.title,a.protocol+"//"+a.host+this.options.root+this.fragment));if(!this.options.silent)return this.loadUrl()},stop:function(){h(window).unbind("popstate",this.checkUrl).unbind("hashchange",this.checkUrl);clearInterval(this._checkUrlInterval);p=!1},route:function(a,b){this.handlers.unshift({route:a,callback:b})},checkUrl:function(){var a=this.getFragment();a==this.fragment&&this.iframe&&(a=this.getFragment(this.iframe.location.hash));
if(a==this.fragment||a==decodeURIComponent(this.fragment))return!1;this.iframe&&this.navigate(a);this.loadUrl()||this.loadUrl(window.location.hash)},loadUrl:function(a){var b=this.fragment=this.getFragment(a);return e.any(this.handlers,function(a){if(a.route.test(b))return a.callback(b),!0})},navigate:function(a,b){if(!p)return!1;b&&!0!==b||(b={trigger:b});var c=(a||"").replace(D,"");this.fragment==c||this.fragment==decodeURIComponent(c)||(this._hasPushState?(0!=c.indexOf(this.options.root)&&(c=this.options.root+
c),this.fragment=c,window.history[b.replace?"replaceState":"pushState"]({},document.title,c)):this._wantsHashChange?(this.fragment=c,this._updateHash(window.location,c,b.replace),this.iframe&&c!=this.getFragment(this.iframe.location.hash)&&(b.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,c,b.replace))):window.location.assign(this.options.root+a),b.trigger&&this.loadUrl(a))},_updateHash:function(a,b,c){c?a.replace(a.toString().replace(/(javascript:|#).*$/,"")+"#"+
b):a.hash=b}});f.View=function(a){this.cid=e.uniqueId("view");this._configure(a||{});this._ensureElement();this.initialize.apply(this,arguments);this.delegateEvents()};var v=/^(\S+)\s*(.*)$/,w="model collection el id attributes className tagName".split(" ");e.extend(f.View.prototype,f.Events,{tagName:"div",$:function(a){return this.$el.find(a)},initialize:function(){},render:function(){return this},remove:function(){this.$el.remove();return this},make:function(a,b,c){a=document.createElement(a);b&&
h(a).attr(b);c&&h(a).html(c);return a},setElement:function(a,b){this.$el=h(a);this.el=this.$el[0];!1!==b&&this.delegateEvents();return this},delegateEvents:function(a){if(a||(a=A(this,"events"))){this.undelegateEvents();for(var b in a){var c=a[b];e.isFunction(c)||(c=this[a[b]]);if(!c)throw Error('Event "'+a[b]+'" does not exist');var d=b.match(v),f=d[1],d=d[2],c=e.bind(c,this),f=f+(".delegateEvents"+this.cid);""===d?this.$el.bind(f,c):this.$el.delegate(d,f,c)}}},undelegateEvents:function(){this.$el.unbind(".delegateEvents"+
this.cid)},_configure:function(a){this.options&&(a=e.extend({},this.options,a));for(var b=0,c=w.length;b<c;b++){var d=w[b];a[d]&&(this[d]=a[d])}this.options=a},_ensureElement:function(){if(this.el)this.setElement(this.el,!1);else{var a=A(this,"attributes")||{};this.id&&(a.id=this.id);this.className&&(a["class"]=this.className);this.setElement(this.make(this.tagName,a),!1)}}});f.Model.extend=f.Collection.extend=f.Router.extend=f.View.extend=function(a,b){var c=l(this,a,b);c.extend=this.extend;return c};
var z={create:"POST",update:"PUT","delete":"DELETE",read:"GET"};f.sync=function(a,b,c){var d=z[a],k={type:d,dataType:"json"};c.url||(k.url=A(b,"url")||H());c.data||!b||"create"!=a&&"update"!=a||(k.contentType="application/json",k.data=JSON.stringify(b.toJSON()));f.emulateJSON&&(k.contentType="application/x-www-form-urlencoded",k.data=k.data?{model:k.data}:{});!f.emulateHTTP||"PUT"!==d&&"DELETE"!==d||(f.emulateJSON&&(k.data._method=d),k.type="POST",k.beforeSend=function(a){a.setRequestHeader("X-HTTP-Method-Override",
d)});"GET"!==k.type&&!f.emulateJSON&&(k.processData=!1);return h.ajax(e.extend(k,c))};f.wrapError=function(a,b,c){return function(d,e){e=d===b?e:d;a?a(b,e,c):b.trigger("error",b,e,c)}};var t=function(){},l=function(a,b,c){var d;d=b&&b.hasOwnProperty("constructor")?b.constructor:function(){a.apply(this,arguments)};e.extend(d,a);t.prototype=a.prototype;d.prototype=new t;b&&e.extend(d.prototype,b);c&&e.extend(d,c);d.prototype.constructor=d;d.__super__=a.prototype;return d},A=function(a,b){return a&&
a[b]?e.isFunction(a[b])?a[b]():a[b]:null},H=function(){throw Error('A "url" property or function must be specified');}}).call(this);