function rbtify() {var extra = 'zaycevnet_web';!function(e){function r(){o=!1;for(var r=0,t=i.length;t>r;r++){var n=e(i[r]).filter(function(){return e(this).is(":appeared")});if(n.trigger("appear",[n]),p[r]){var a=p[r].not(n);a.trigger("disappear",[a])}p[r]=n}}function t(e){i.push(e),p.push()}var i=[],n=!1,o=!1,a={interval:250,force_process:!1},f=e(window),p=[];e.expr[":"].appeared=function(r){var t=e(r);if(!t.is(":visible"))return!1;var i=f.scrollLeft(),n=f.scrollTop(),o=t.offset(),a=o.left,p=o.top;return p+t.height()>=n&&p-(t.data("appear-top-offset")||0)<=n+f.height()&&a+t.width()>=i&&a-(t.data("appear-left-offset")||0)<=i+f.width()?!0:!1},e.fn.extend({appear:function(i){var f=e.extend({},a,i||{}),p=this.selector||this;if(!n){var u=function(){o||(o=!0,setTimeout(r,f.interval))};e(window).scroll(u).resize(u),n=!0}return f.force_process&&setTimeout(r,f.interval),t(p),e(p)}}),e.extend({force_appear:function(){return n?(r(),!0):!1}})}(function(){return jQuery}());function registerDefaultService(e){var t;(t=jQuery.rbtify.services).register(e,t.templates.use("default",{name:e}))}!function(h){var o={version:"0.28.77",messagesType:"main",offerOr:"или",loading:"Загрузка...",checkUrl:"//api.advmusic.net",checkOperatorUrl:"//api.advmusic.net/check-abonent.php",statsUrl:"//api.advmusic.net/stats.php",lpType:"action",offerSeparator:"----",offerPrefix:"* - ",extra:extra,stickerClass:"offer_sticker",stickerZIndex:999999,stickerCloseClass:"offer_sticker_close",offerMore:"Подробнее...",cancelButton:"Отмена",jsonpCallbackPrefix:"jQuery",sessionCookieName:"rbtify_session_id",sessionCookiePeriod:86400,httpsCookie:"http_force",httpsRedirectCookie:"http_redirect",stickerCss:{position:"fixed",width:"100%",background:"white",borderTop:"#DDD 1px solid",fontSize:"11px",padding:"5px",paddingRight:"15px",zIndex:999999},stickerOffset:0,stickerCloseCss:{right:12,top:-14,position:"absolute",fontSize:"20px",cursor:"pointer",padding:10},offerTextCss:{},offerAcceptCss:{},offerCancelCss:{},useHttps:"https:"==window.location.protocol,blankCallback:!1,popupJs:"//scripts.advmusic.net/assets/js/jquery.modal.min.js",popupCss:"//scripts.advmusic.net/assets/css/jquery.modal.css",popupClass:"rbt-modal",zvuk:{imgUrl:"//scripts.advmusic.net/assets/img/zvuk.png",padding:"auto"},blacklist:[]},r={},n={},s={},g={},u=null,p={},t=null,m=!1,v=!1,b=!1,y=!1;function a(e){var t,r,n=decodeURIComponent(window.location.search.substring(1)).split("&");for(r=0;r<n.length;r++)if((t=n[r].split("="))[0]===e)return void 0===t[1]||t[1]}function c(e,t,r,n){if(replaceDuplicates=!0,0<e.indexOf("#")){var i=e.indexOf("#");urlhash=e.substring(e.indexOf("#"),e.length)}else urlhash="",i=e.length;sourceUrl=e.substring(0,i);var o=sourceUrl.split("?"),s="";if(1<o.length&&""!=o[1])for(var a=o[1].split("&"),c=0;c<a.length;c++){var u=a[c].split("=");replaceDuplicates&&u[0]==t||(""==s?s="?":s+="&",s+=u[0]+"="+(u[1]?u[1]:""))}return""==s&&(s="?"),n?s="?"+t+"="+r+(1<s.length?"&"+s.substring(1):""):(""!==s&&"?"!=s&&(s+="&"),s+=t+"="+(r||"")),o[0]+s+urlhash}function l(e,t,r){var n;if(r){var i=new Date;i.setTime(i.getTime()+1e3*r),n="; expires="+i.toGMTString()}else n="";document.cookie=e+"="+t+n+"; path=/"}function f(e){return 0<document.cookie.length&&(c_start=document.cookie.indexOf(e+"="),-1!=c_start)?(c_start=c_start+e.length+1,c_end=document.cookie.indexOf(";",c_start),-1==c_end&&(c_end=document.cookie.length),unescape(document.cookie.substring(c_start,c_end))):""}function d(e){return null!==t||""==(t=f(e.sessionCookieName))&&(t=function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}(),l(e.sessionCookieName,t,e.sessionCookiePeriod)),t}function w(e,t,r){var n,i,o,s,a=h.Deferred(),c=k(e);return h.ajax({url:(n=e,i=t,o=c,s=r,j(n.statsUrl,{extra:n.extra,session_id:d(n),message:i,context:s},o,n)),cache:!1,dataType:x(e.statsUrl,e),jsonpCallback:c,success:function(e){a.resolve(e)}}),a.promise()}function k(e){return e.jsonpCallbackPrefix+Date.now()}function x(e,t){return-1<e.indexOf(t.jsonpCallbackPrefix)?"jsonp":"json"}function C(t,e,r,n,i,o){var s=p[e],a=null;if(s)a=s;else{a=h.Deferred();p[e]=a;var c=k(n);h.ajax({url:D(t,r.origName,r.artist,r.origGenre,r.matchType,n,null,c,i,o),cache:!1,dataType:x(n.checkUrl,n),jsonpCallback:c,success:function(e){return e.data&&e.data.common&&e.data.common.stats_url&&!n.useHttps&&(n.statsUrl=e.data.common.stats_url),e.data&&e.data.common&&e.data.common.get_operator_url&&!n.useHttps?(n.checkUrl=e.data.common.get_operator_url,h.ajax({url:D(t,r.origName,r.artist,r.origGenre,r.matchType,n,null,c,i,o),cache:!1,dataType:x(n.checkUrl,n),jsonpCallback:c,success:function(e){a.resolve(e)}})):a.resolve(e),e}})}return a.promise()}function _(e){var t=document.createElement("a");return t.setAttribute("href",e),"https:"==t.protocol?e.replace("https://","http://"):e}function j(r,e,t,n,i){e||(e={}),n.useHttps&&(e.secure=n.useHttps,httpsUrl=r.split("http://"),1<httpsUrl.length&&(r="https://"+httpsUrl.pop())),t&&(r=r.replace("jQueryId",t)),!1!==i&&(e.session_id=d(n));var o=r.split("?"),s="";return h.each(e,function(e,t){r=r.replace("%%"+e+"%%",encodeURIComponent(t))}),r=(r=r.replace(new RegExp("%%[^%]+%%","g"),"")).replace(new RegExp("[?&]+$","g"),""),h.isEmptyObject(e)||(s="?",1<o.length&&""!=o[1]&&(s="&")),r=r+s+h.param(e)}function D(e,t,r,n,i,o,s,a,c,u){var p={extra:o.extra,content_code:e,name:t,context:c,match_type:i,state:JSON.stringify(u)};r&&(p.artist=r),n&&(p.genre=n),s&&(p.return_url=s,p.lp_type=o.lpType);var l=j(o.checkUrl,p,a,o);return l=E(l,c)}var i=null;function O(e,t,r){var n=t.popupClass;r.popupClass&&(n+=" "+r.popupClass),e.modal({modalClass:n,closeText:"&#xd7;"})}var $={};function P(t){var r=h.Deferred();return $[t]?r.resolve($[t]):h.ajax({url:t,cache:!1}).done(function(e){$[t]=e,r.resolve(e)}),r.promise()}var S=[],U=null;function W(e,t,r){w(e,"Open popup",r.context);var n,i,o,s,a,c,u=null;return(u=r.mode&&"blank"===r.mode?(a=t,c=h.Deferred(),window.location.href=a,c.resolve(),c.promise()):!0===r.frame?function(e,t,r){var n=h.Deferred();$e=h("<div />"),h("body").append($e),O($e,e,r);var i=h('<iframe frameborder="no" width="100%" height="100%" />'),o=i[0];return i.attr("src",t),$e.append(i),T(i,r),o.onload=function(){T($e,r),T(i,r)},window.addEventListener("message",function(e){"rbt_close_popup"==e.data&&(h.modal.close(),r.close&&r.close($e[0]))}),$e.on(h.modal.CLOSE,function(e,t){r.close&&r.close($e[0]),n.resolve($e[0])}),n.promise()}(e,t,r):(n=e,i=t,o=r,s=h.Deferred(),$e=h("<div />"),h("body").append($e),P(i).done(function(e){$e.html(e),$e.on(h.modal.CLOSE,function(e,t){o.close&&o.close($e[0]),s.resolve($e[0])}),$e.on(h.modal.OPEN,function(e,t){$e.height()>h(window).height()&&$e.css({height:.8*h(window).height()}),o.open&&o.open($e[0])}),O($e,n,o)}),s.promise())).done(function(){w(e,"Close popup",r.context)}),u}function T(e,t){var r=.9,n=.8,i=!1;t.fullscreen&&(n=r=1,i=!0);var o=h(window).width()*r,s=h(window).height()*n;t.height&&s>t.height&&(s=t.height,i=!1),t.width&&o>t.width&&(o=t.width,i=!1),e.css({width:o,height:s}),i&&e.css({position:"absolute",top:0,left:0})}function A(e,t,r,n,i){var o=n.el;n.widgetEl&&(o=n.widgetEl);var s=h(o),a=s,c=h("<div />");n.wrapperCss&&c.css(n.wrapperCss),c.append(e),i.wrapWidget&&(c=i.wrapWidget(c)),s.replaceWith(c),r.always(function(e){c.replaceWith(a)})}var N=null;function E(e,t){return res=e,null!=t&&(res=res.replace(/(context=)(.*?)(&)/,"$1"+t+"$3"),res=res.replace(/(context%3D)(.*?)(%26)/,"$1"+t+"$3")),res}function M(e,t){return!(!t.data||!t.data[e])&&t.data[e]}function R(n,i,o,s){var a={};return h.each(r,function(e,t){var r=M(e,i);!r||"default"!==o&&o&&r.context&&-1==h.inArray(o,r.context)||t.check&&!t.check(n,r,o,s)||(a[e]=t)}),a}function q(f,d){var p=function(){var n=h.Deferred(),e=Array.prototype.slice.call(arguments),t=null,i=e.shift(),r=e.shift(),o=e.shift(),s=null;2==e.length&&(s=e[0],t=e[1]),1==e.length&&(t=e[0]),t&&"string"==typeof t&&(s=t,t=null),b&&console.log("rbtify notice:",i,"invoked","with data",d),s&&!t&&(t=function(){f.blankCallback?window.open(s,"_blank"):window.location.href=s}),t&&(t=h.proxy(t,this)),w(f,'Click on "'+i+'" button for "'+d.origName+'" song',i);var a,c,u,p=(c={},u=R(f,a=r,i,d),h.isEmptyObject(u)||h.each(u,function(e,t){var r=M(e,a);if(t.getState){var n=t.getState(r);n&&(c[e]=n)}}),c);C(d.rbtTBCode,d.key,d,f,i,p).fail(function(){n.reject()}).done(function(e){var t=R(f,e,i,d),r=h.extend({},d);(function(e,s,a,i,o,c,u){var t=h.Deferred(),p=[];return h.each(e,function(e,t){if(t[s]){var r=M(e,i),n=function(r,e,t,n,i,o){return e[s](a,t,n,i,o).then(function(e){var t={};return e&&(t[r]=e),t})};t.init?(g[e]||(g[e]=t.init(a,r)),g[e].done(function(){p.push(n(e,t,r,o,c,u))})):p.push(n(e,t,r,o,c,u))}}),0==p.length?t.resolve({}):h.when.apply(this,p).done(function(){var r={};h.each(arguments,function(e,t){t&&h.each(t,function(e,t){r[e]=t})}),t.resolve(r)}),t.promise()})(t,"invoke",f,e,i,r,o).fail(function(){b&&console.log("rbtify notice:",i,"rejected"),n.reject()}).done(function(e){b&&console.log("rbtify notice:",i,"done"),!1!==y&&(b&&console.log("rbtify notice: close offer"),y.remove()),n.resolve()})});var l=n.promise();return l.always(function(){t&&t()}),l},l=function(e,n,i,t){var r,o=h.Deferred(),s=R(f,n,e,d),a={};return i?(h.each(s,function(e,t){var r=M(e,n);r[i]&&(a[e]=r[i])}),t?a[t]?o.resolve(a[t]):o.reject():o.resolve(a)):o.resolve(!!(r=n).data&&r.data),o.promise()};h.proxy(f.bind,this,h.proxy(function(s,a,e,c){"string"==typeof a&&h.rbtify.binders.has(a)||(c=e,e=a,a="default"),"object"!=typeof e||e instanceof jQuery||(c=e,e=h(this));var u="*";function r(r){var e,n,i,t=h(location).attr("href"),o="rbt-binded-"+a;r.data(o)||(e=f.blacklist,n=t,i=!1,h.each(e,function(e,t){if(n.match(t))return!(i=!0)}),i)||(r.data(o,!0),h.rbtify.binders.init(a,r,u,c,f,d),function(a){if(z)return z;var e,c=h.Deferred();return(e=a,C(null,"init",{},e,"init")).done(function(e){var t,n,i,r,o,s=R(a,e);(t=s,n=a,i=e,r=h.Deferred(),o=[],h.each(t,function(e,t){var r=M(e,i);t.init&&(g[e]||(g[e]=t.init(n,r),o.push(g[e])))}),0==o.length?r.resolve():h.when.apply(null,o).done(function(){b&&console.log("rbtify notice: all services inited"),r.resolve()}),r.promise()).done(function(){!m&&a.noOffer&&a.noOffer(),!v&&a.noWidget&&a.noWidget()}),c.resolve(e)}),z=c.promise()}(f).done(function(e){var t=R(f,e,a,d);h.isEmptyObject(t)||h.rbtify.binders.bind(a,h.proxy(p,this,a,e),h.proxy(l,this,a,e),r,u,c,d,f,s)}))}"string"==typeof e?(u=e,e=h(this).find(e)):e&&(u=e.selector),"string"!=typeof a||e||c||(e=h(this));var n=this,t=h(n);t.on("DOMNodeInserted",function(e){t.find(u).each(function(e,t){h.proxy(r,n)(h(t))})}),h.proxy(r,this)(e)},this,{}))()}function I(e,t){if(t.bind){var r="";t.search&&(r=h.proxy(t.search,this)());var n,i,o,s=function(e){if("object"==typeof e&&e.name&&e.artist&&e.query)throw"It is not possible to use name and artist along with query in search";return"object"==typeof e&&e.name&&e.artist?e.artist.trim()+" "+e.name.trim():"object"==typeof e&&e.query?e.query.trim():"object"==typeof e?"":e.trim()}(r),a="object"==typeof(n=r)&&n.genre&&""!=n.genre.trim()?n.genre.trim():null,c={artist:"object"==typeof(i=r)&&i.artist&&""!=i.artist.trim()?i.artist.trim():null,name:"object"==typeof(o=r)&&o.name&&""!=o.name.trim()?o.name.trim():null,origName:s,origGenre:a,el:this,key:e};h.proxy(q,this)(t,c)}}var Q=!1;var z=null;function H(r,e,t){function n(e,t,r){if((!r.if||r.if())&&!h(e).data("rbtified")){h(e).data("rbtified",!0);var n=h.proxy(I,e,t,r);setTimeout(n,0)}}return h(document).on("DOMNodeInserted",function(e){h(t).each(function(e,t){n(t,e,r)})}),e.each(function(e,t){n(t,e,r)}),e}function B(r,e){return h.each(e,function(e,t){r[t]=function(e,n){var i=e;a("api_type")&&(i=c(i=i.replace("/api/","/api-"+a("api_type")+"/"),"api_type",a("api_type")));a("api_rev")&&(i=c(i,"rev",a("api_rev")));h.each(["opgroup","service","mobile","delivery_method","opid","happy","nowait","purchase","device","msisdn"],function(e,t){var r="test_"+t;a(r)?i=c(i,r,a(r)):n&&n[t]?i=c(i,r,n[t]):f(r)&&(i=c(i,r,f(r)))}),a("rbt_debug")&&(i=c(i,"debug",a("rbt_debug")));a("purge")&&(i=c(i,"purge",a("purge")));return h.each(["source","medium","campaign","term","content"],function(e,t){var r="utm_"+t;a(r)&&(i=c(i,r,a(r)))}),i}(r[t],r.test)}),r}var L=function(r,n,i){f("rbt_debug")&&(b=!0);var e,t=r;if(n.selector&&(t=r,r=n.selector),i||(i=h(r)),n=B(n=h.extend({},o,n),["checkUrl","statsUrl","checkOperatorUrl"]),e=n,Q||(Q=!0,b&&console.log("rbtify notice: "+e.extra+" rbtify-"+e.version+", jquery-"+h.fn.jquery),w(e,'Current location is "'+window.location.href+'"')),0==i.length&&b&&console.log('rbtify notice: no elements for rbtify, check section "'+t+'"'),n.useHttps||"true"!=f(n.httpsRedirectCookie)||l(n.httpsRedirectCookie,!1),n.useHttps&&"true"==f(n.httpsRedirectCookie)&&w(n,'Loop of death at "'+window.location.href+'"'),!n.useHttps||"false"!=f(n.httpsRedirectCookie)&&""!=f(n.httpsRedirectCookie))return H(n,i,r);h.ajax({url:j(n.checkOperatorUrl,{},null,n),cache:!1,success:function(e){if(e&&n.https){var t=window.location.href;!0!==n.https&&(t=n.https(t,h.rbtify.api)),l(n.httpsCookie,!0),l(n.httpsRedirectCookie,!0),window.location.replace(_(t))}else{if(!e||!n.httpsCallback)return H(n,i,r);n.httpsCallback()}}})};h.fn.rbtify=function(e){$els=h(this),b&&console.log("rbtify notice: using deprecated init method"),L($els.selector,e,$els)},h.rbtify={version:o.version,init:function(e,r){if("string"==typeof e)L(e,r);else if("object"==typeof e&&null==r)h.each(e,function(e,t){L(e,h.extend({},t))});else{var t=r;r=e;h.each(t,function(e,t){L(e,h.extend({},r,t))})}},binders:{register:function(e,t,r,n){s[e]={bind:t,init:r,args:n}},fetchBinder:function(i){var o=null;return s[i]?{binder:s[i],matches:null}:(h.each(s,function(e,t){var r=new RegExp(e),n=i.match(r);if(n)return!(o={binder:t,matches:n})}),o)},has:function(e){return!!this.fetchBinder(e)},bind:function(e,t,r,n,i,o,s,a,c){var u=this.fetchBinder(e),p=u.binder;c[e]={binder:u.binder,selector:i};var l=h.extend({},p.args,o,{matches:u.matches},{data:s},{binds:c},{el:n[0]});p.bind(e,t,r,n,i,l,a)},init:function(e,t,r,n,i,o){var s=this.fetchBinder(e),a=s.binder,c=h.extend({},a.args,n,{matches:s.matches},{data:o});a.init(e,t,r,c,i)}},services:{register:function(e,t){t||(t={}),r[e]=t},templates:{register:function(e,t){n[e]=t},use:function(e,t){return n[e](t)}}},api:{popup:{show:function(e,t,r){S.push([e,t,r]),function e(t,r,n){null==U&&0!=S.length&&(U=W.apply(this,S.shift())).done(function(){U=null,e()})}()},init:function(e,t){var n=h.Deferred();return null!==i||(i=n.promise(),e.popupJs?h.getScript(j(e.popupJs,null,null,e,!1)).done(function(){e.popupCss&&(h("head").append(h('<link rel="stylesheet" type="text/css" />').attr("href",j(e.popupCss,null,null,e,!1))),n.resolve())}).fail(function(e,t,r){n.resolve(!1)}):(e.popupCss&&h("head").append(h('<link rel="stylesheet" type="text/css" />').attr("href",j(e.popupCss,null,null,e,!1))),n.resolve())),i},get:P,close:function(){h.modal.close()}},widget:{show:function(r,e,t,n){if(e&&!v){v=!0;var i=h.Deferred(),o=h('<iframe frameborder="no" scrolling="no" width="100%" />'),s=o[0];s.onload=function(){t.height&&o.height(t.height),t.width&&o.width(t.width),i.resolve(s),b&&console.log("rbtify notice: show widget"),w(r,"Show widget")},s.src=e;var a=A;return r.setWidget&&(a=r.setWidget),a(o,i.promise(),n,t,r),n.always(function(e){b&&console.log("rbtify notice: close widget"),w(r,"Close widget",e)}),window.addEventListener("message",function(e){if(0===e.data.indexOf("rbt_")){var t=e.data.replace("rbt_","");r[t]&&h.proxy(r[t],this)(),n.resolve(t)}}),n.promise()}}},offer:{show:function(e,t){if(t.offer){var r=t.offer.split(e.offerSeparator),n=r[0],i=r[1],o={render:function(){return e.offerPrefix+n+"&nbsp;"},renderMore:function(){return i},hasMore:!!i};if(w(e,"Show offer"),e.setOffer){var s=e.setOffer();y=function(e,t,r,n){var i=h("<div />"),o=h("<span />").html(t.render());if(o.css(r.offerTextCss),e.append(i),i.append(o),t.hasMore){var s=h('<a href="#">'+r.offerMore+"</a>");i.append(s),s.click(function(){return s.remove(),o.html(t.render()+" "+t.renderMore()),!1})}if(n.use_select_menu&&e.append(makeSelectMenu(r)),!0===n.use_checkbox&&n.checkbox){var a=h("<div />");if(a.css(r.offerAcceptCss),i.append(a),u=h('<input type="checkbox"/>'),a.append(u),u.attr("checked",!0),a.append(h("<span>&nbsp;"+n.checkbox+"</span>")),u.click(function(){u.is(":checked")?w(r,"Checkbox check"):w(r,"Checkbox uncheck")}),!1===n.checkbox_state&&u.removeAttr("checked"),!0===n.use_cancel){var c=h('<a href="#">'+r.cancelButton+"</a>");c.css(r.offerCancelCss),i.append(c),c.click(function(){return u.removeAttr("checked"),w(r,"Cancel click"),!1})}}return i}(s,o,e,t)}else y=function(e,t,r){var n=function(e,t){if(null!==N)return N;var r=h("<div />");r.addClass(t.stickerClass),r.css(t.stickerCss),r.css("bottom",t.stickerOffset);var n=h("<div>&times;</div>");n.addClass(t.stickerCloseClass),n.css(t.stickerCloseCss),r.append(n);var i=!1;return h(document.body).append(r),n.click(function(e){return r.hide(),!(i=!0)}),e&&e.appear?(e.appear(),e.on("appear",function(e){i||r.hide()}),e.on("disappear",function(e){i||r.show()}),h.force_appear()):r.show(),N=r}(e,r),i=h("<div />");if(n.append(i),i.html(i.html()+t.render()),t.hasMore){var o=h('<a href="#">'+r.offerMore+"</a>");i.append(o),o.click(function(){return o.remove(),i.html(i.html()+" "+t.renderMore()),!1})}return n}(s,o,e);b&&console.log("rbtify notice: show offer"),m=!0}},isConfirmed:function(){return!(null!==u&&!u.is(":checked"))}},log:{info:w},cookie:{set:l,get:f},query:{set:function(e,t){var r=e;return h.each(t,function(e,t){r=c(r,e,t)}),r},get:a,context:E,url:j,httpsify:function(e){var t=document.createElement("a");return t.setAttribute("href",e),"http:"==t.protocol?e.replace("http://","https://"):e},dehttpsify:_},debug:function(){return b}}}}(jQuery),function(p,l){function f(e,t){var r=[],n=p._data(e,"events");if(e.eventList,n){var i=p._data(e,"events")[t.split(".")[0]];i&&(r=i)}return r}function d(e,t,r){var n=f(e,t),i=null,o=p.grep(n,function(e){return e.type==t&&e.handler===r});1==o.length&&(i=o[0]);var s=-1;i&&(s=n.indexOf(i)),-1<s?(n.splice(s,1),n.splice(0,0,i)):p(e).bind(t,r)}function h(e,t,r,n){var i,o,s,a,c,u,p=(s=r,a=function(e){d(e,t,n)},c=f(i=e,o=t),u=c.length,setInterval(function(){var e=f(i,o);e.length>u&&(a(i,c),u=e.length)},s));return d(e,t,n),p}var e=function(e,t,r,n,i){n.init&&p.proxy(n.init,t[0])(i,n)},t=function(e,r,t,n,i,o,s){if(0!==n.length){if(r=p.proxy(r,n[0],o),o&&o.ready&&p.proxy(o.ready,n[0])(t,r,o,s),o&&o.onClick){var a="click",c=null,u=function(e){clearTimeout(c),f(this,a).shift(),o.preventDefault&&(e.preventDefault(),e.stopImmediatePropagation(),e.stopPropagation());var t=p(this);if(p.proxy(o.onClick,this)(t[0],r).always(function(){t.trigger(a),"always"==o.show&&(c=h(t[0],a,100,u))}),o.preventDefault)return!1};c=h(n[0],a,100,u)}}else l.debug()&&console.log('rbtify notice: no elements for "'+e+'" binder found, check your selector "'+i+'"')};p.rbtify.binders.register("default",function(e,t,r,i,n,o){0!==i.length?r().done(function(e){var t=!0,r={},n=!1;t&&o&&o.match&&o.match.service&&!e[o.match.service]&&(t=!1),t&&o&&o.match&&o.match.service&&e[o.match.service]&&(r=e[o.match.service],n=o.match.service),t&&o&&o.match&&o.match.context&&(t&&n&&!e[n].context&&(t=!1),t&&n&&e[n].context&&-1==p.inArray(o.match.context,e[n].context)&&(t=!1),t&&!n&&(p.each(e,function(e,t){t.context&&-1!==p.inArray(o.match.context,t.context)&&(n=e,r=t)}),n||(t=!1))),t&&(o&&o.invoke&&p.proxy(o.invoke,i[0])(r),o&&o.css&&i.css(o.css))}):l.debug()&&console.log('rbtify notice: no elements for "'+e+'" binder found, check your selector "'+n+'"')},e,{}),p.rbtify.binders.register("stream",t,e,{show:"once",preventDefault:!0,onClick:function(e,t){return t()}}),p.rbtify.binders.register("download",t,e,{show:"once",preventDefault:!0,onClick:function(e,t){return t(p(this).attr("href"))}}),p.rbtify.binders.register("purchase",t,e,{show:"always",onClick:function(e,t){return t()},init:function(e,t){t.setText&&p.proxy(t.setText,this)(e.loading,"loading")},setText:function(e,t){"default"!=t&&p(this).find("span").html(e)}}),p.rbtify.binders.register("([a-z-]+)-widget",t,e,{show:"once",ready:function(e,t,r,n){t()}}),p.rbtify.binders.register("([a-z-]+)-button",t,e,{show:"always",init:function(e,t){if(!t.mode||"show"!=t.mode){var r=t.matches[1],n="rbt-"+r,i=p(this).find("."+n);if(!(0<i.length)){t.el?$el=p(this).find(t.el):$el=p(this);var o=24;if(t.size&&(o=t.size),i=p('<a target="_blank" />').addClass(n),t.className&&i.addClass(t.className),e[r]&&e[r].imgUrl){var s=p("<img />");s.attr({src:e[r].imgUrl,width:o,height:o}).width(o).height(o),t.imgCss&&s.css(t.imgCss),i.append(s)}if(e[r]&&e[r].padding&&"auto"==e[r].padding){var a=o/3;t.padding&&(a=t.padding),i.css({padding:a})}var c=i;t.wrapper&&((c=p(t.wrapper)).append(i),t.wrapperCss&&c.css(t.wrapperCss)),c.hide();var u=$el;t.target&&(u=p(t.target)),t.mode?u[t.mode](c):u.prepend(c),i.click(function(e){e.stopPropagation()}),t.css&&i.css(t.css)}}},ready:function(e,t,r,n){var i=null,o=r.matches[1],s="rbt-"+o,a=i=r.mode&&"show"==r.mode?p(this):p(this).find("."+s);r.wrapper&&(a=i.parent()),e("button_text",o).done(function(e){if(r.textWrapper){var t=p(r.textWrapper);i.append(t),t.text(e),r.textWrapperCss&&t.css(r.textWrapperCss)}else i.text(e)}),e("url",o).done(function(e){e=l.query.url(e,{name:r.data.name,artist:r.data.artist,genre:r.data.genre},null,n),i.attr("href",e)}).fail(function(){i.click(function(e){return e.preventDefault(),e.stopImmediatePropagation(),e.stopPropagation(),t(),!1})}),r.showCss&&i.css(r.showCss),r.onShow?(a.show(),p.proxy(r.onShow,i)(e)):a.show()}})}(jQuery,jQuery.rbtify.api),function(p,l){p.rbtify.services.templates.register("default",function(a){var s=!1;return{check:function(e,t,r,n){return this.canShow(e,t,r,n)},init:function(e,t){var r=p.Deferred().resolve().promise();return this.isPopup(t)?r=this.initPopup(e,t):this.isOffer(t)&&l.offer.show(e,t),this.hasWelcome(t)&&(r=p.when(this.initWelcome(e,t),r)),r},getState:function(e){return{delivery_method:e.delivery_method}},canShow:function(e,t,r,n){var i=this.sleepKey(e,t);return"true"==l.query.get("test")||!l.cookie.get(i)},canInvoke:function(e,t,r,n,i){var o=!1;return i.show&&"always"===i.show&&(o=!0),(!s||o)&&this.canShow(e,t,r,n)},sleepKey:function(e,t){return a.name+"-sleep-interval"},sleep:function(e,t,r){if(t[r]){var n=this.sleepKey(e,t);l.cookie.get(n)||l.cookie.set(n,t[r])}},purchase:function(e,t,r){l.debug()&&console.log("rbtify notice: purchase "+a.name);var n=p.Deferred();if(!t.purchase_url)return n.resolve(),n.promise();this.sleep(e,t,"purchase_interval");var i="ajax";switch(t.purchase_method&&(i=t.purchase_method),i){case"iframe":var o=p('<iframe frameborder="no" scrolling="no" width="0" height="0" />');o.attr("src",t.purchase_url),p("body").append(o);break;default:p.ajax({url:l.query.context(t.purchase_url,r),cache:!1})}return n.resolve(),n.promise()},initPopup:function(e,t){return l.popup.init(e).then(function(){return t.frame&&1==t.frame?p.Deferred().resolve().promise():t.popup_url?l.popup.get(t.popup_url):p.Deferred().resolve().promise()})},initWelcome:function(e,t){return l.popup.init(e).then(function(){return l.popup.get(t.welcome_url)})},defaultRenderPopup:function(e,t,r){var n=p(r);n.find(".rbt-offer").html(t.offer),n.find(".rbt-title").html(t.content_name),0<n.find(".rbt-agree input").length&&n.find(".rbt-agree input").prop("checked",t.checkbox_checked)},renderPopup:function(e,t,r){a.popup&&a.popup.render?a.popup.render(e,t,r):this.defaultRenderPopup(e,t,r)},popupArgs:function(e,t,r,n){var i=a.name;a.popupClass&&(i=a.popupClass);var o={close:function(){r.resolve()},popupClass:i,context:n,width:t.width,height:t.height,fullscreen:t.fullscreen};if(t.frame&&1==t.frame)var s=this.framePopupArgs(e,t,r,n);else s=this.templatePopupArgs(e,t,r,n);return p.extend(o,s)},templatePopupArgs:function(r,e,n,t){var i=p.proxy(this.purchase,this,r,e,t),o=p.proxy(this.renderPopup,this,r,e);return{open:function(e){var t=p(e);o(e),t.find(".rbt-cancel").click(function(){l.log.info(r,"Cancel"),n.resolve(e),l.popup.close()}),t.find(".rbt-agree input").click(function(){t.find(".rbt-agree input").prop("checked")?l.log.info(r,"Check checkbox"):l.log.info(r,"Uncheck checkbox")}),t.find(".rbt-confirm").click(function(){!1!==t.find(".rbt-agree input").prop("checked")&&(l.log.info(r,"Confirm"),i().done(function(e){n.resolve(e),l.popup.close()}))})}}},framePopupArgs:function(e,t,r){return{frame:!0}},showPopup:function(e,t,r){l.debug()&&console.log("rbtify notice: show popup "+a.name);var n=p.Deferred(),i=p.proxy(this.sleep,this,e,t,"show_interval");return l.popup.show(e,t.popup_url,this.popupArgs(e,t,n,r)),n.done(function(){i()}),n.promise()},widgetArgs:function(e,t,r,n,i){return{el:i.el,wrapperCss:i.wrapperCss,width:i.width,height:i.height}},showWelcome:function(e,t,r){var n=t;n.width=t.welcome_width,n.height=t.welcome_height,l.popup.show(e,t.welcome_url,this.popupArgs(e,n,p.Deferred(),r))},showWidget:function(e,t,r,n,i){var o=p.Deferred(),s=p.proxy(this.sleep,this,e,t,"purchase_interval"),a=l.query.url(t.widget_url,{name:t.name,artist:t.artist,genre:t.genre},null,e);l.widget.show(e,a,this.widgetArgs(e,t,r,n,i),o);var c=i.binds,u=i.el;return o.done(function(e){s()}).always(function(e){if(c[e]){var t=c[e];p(u).find(t.selector).click()}}),o.promise()},doNothing:function(){return l.debug()&&console.log("rbtify notice: do nothing "+a.name),p.Deferred().resolve().promise()},isWidget:function(e){return"widget"==e.delivery_method&&!!e.widget_url},isContextWidget:function(e){return"context_widget"==e.delivery_method},isPopup:function(e){return"popup"==e.delivery_method},isOffer:function(e){return"offer"==e.delivery_method&&!!e.offer},hasWelcome:function(e){return!!e.welcome_url},invoke:function(e,t,r,n,i){return this.canInvoke(e,t,r,n,i)?(s=!0,this.isPopup(t)?this.showPopup(e,t,r):this.isOffer(t)&&l.offer.isConfirmed()?this.purchase(e,t,r):this.isWidget(t)?this.showWidget(e,t,r,n,i):this.doNothing()):this.doNothing()}}})}(jQuery,jQuery.rbtify.api),function(e,t){e.rbtify.services.register("debug",{init:function(e,t){alert(JSON.stringify(t,null,2))}})}(jQuery,jQuery.rbtify.api);var defaultServices=["mts-rbt","tele2-rbt","tele2-333","tele2-rft","ringtones","mts-rft-pockets","megafon-rbt"],buttonServices=["zvuk","zaycevfm","rbt-form"];jQuery.each(defaultServices,function(e,t){registerDefaultService(t)}),jQuery.each(buttonServices,function(e,t){$.rbtify.services.register(t)});
function template(t){return{mode:"after",target:".button-share",textWrapper:'<span class="button__text"></span>',className:"button",css:$.extend({},t)}}$.rbtify.init({".audiotrack__info":{search:function(){return{artist:$(this).find(".musicset-track__artist").text(),name:$(this).find(".musicset-track__track-name").text()}},bind:function(t){t("download",".button-download__link"),t("stream",".musicset-track__control"),t("zaycevfm-button",".button-vip",{mode:"show",showCss:{display:"inline-flex","margin-right":"6px"}}),t("rbt-form-button","#audiotrack-buttons",template({}))}},".audiotrack__artist-tracks .musicset-track":{search:function(){return{artist:$(this).find(".musicset-track__artist").text(),name:$(this).find(".musicset-track__track-name").text()}},bind:function(t){t("stream",".musicset-track__control"),t("download",".musicset-track__download a")}}});
} function defer(method) { if (window.jQuery) { method(); } else { setTimeout(function() { defer(method) }, 50); } } defer(rbtify);